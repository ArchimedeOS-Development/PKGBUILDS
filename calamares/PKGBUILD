# Maintainer: Killian Prin-abeil <killian@archimedeos.org>
# Contributor: ArchimedeOS Development Team <hi@archimedeos.org>

pkgname=calamares
pkgver=1.0.0
pkgrel=3
pkgdesc="Installateur graphique pour ArchimedeOS"
arch=('x86_64')
url="https://github.com/ArchimedeOS-Development/calamares"
license=('GPL3')
depends=('qt5-base' 'qt5-svg' 'qt5-tools' 'qt5-xmlpatterns' 'qt5-webengine' 'qt5-webview'
         'kcoreaddons' 'kconfig' 'ki18n' 'kservice' 'kwidgetsaddons' 'kpmcore'
         'boost' 'yaml-cpp' 'networkmanager' 'upower' 'kiconthemes' 'kio'
         'solid' 'kxmlgui' 'kparts' 'knewstuff' 'python' 'polkit-qt5')
makedepends=('git' 'cmake' 'extra-cmake-modules' 'qt5-tools' 'python-pyqt5'
             'python-yaml' 'python-setuptools' 'python-mock' 'python-jsonschema')
optdepends=('python-pyqt5: pour les modules Python'
            'python-yaml: pour la configuration YAML'
            'python-setuptools: pour les modules Python'
            'python-mock: pour les tests'
            'python-jsonschema: pour la validation JSON')
provides=('calamares')
conflicts=('calamares-git')
source=("git+${url}.git")
sha256sums=('SKIP')

prepare() {
    cd "${srcdir}/${pkgname}"
    mkdir -p build
}

build() {
    cd "${srcdir}/${pkgname}/build"

    cmake .. \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=Release \
        -DWITH_PYTHON=ON \
        -DWITH_WEBVIEW=ON \
        -DWITH_CRASHREPORTER=ON \
        -DWITH_APPSTREAM=ON \
        -DWITH_QT6=ON

    make
}

package() {
    cd "${srcdir}/${pkgname}/build"
    make DESTDIR="${pkgdir}" install

    install -dm755 "${pkgdir}/usr/share/doc/${pkgname}"
    cp -r "${srcdir}/${pkgname}/doc"/* "${pkgdir}/usr/share/doc/${pkgname}/" || true
}
